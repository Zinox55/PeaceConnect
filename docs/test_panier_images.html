<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Panier Images</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; overflow-x: auto; }
        img { max-width: 100px; max-height: 100px; margin: 5px; border: 2px solid #ddd; }
    </style>
</head>
<body>
    <h1>üß™ Test des Images du Panier</h1>
    
    <div id="results"></div>
    
    <script>
        const API_URL = 'controller/PanierController.php';
        
        fetch(API_URL)
            .then(r => r.json())
            .then(data => {
                const resultsDiv = document.getElementById('results');
                
                if (data.success) {
                    let html = `<div class="test-result success">
                        <h2>‚úÖ API Response OK</h2>
                        <p><strong>Nombre d'articles:</strong> ${data.data.length}</p>
                        <p><strong>Total:</strong> ${data.total} ‚Ç¨</p>
                    </div>`;
                    
                    data.data.forEach((item, index) => {
                        const rawImage = (item.image || '').trim();
                        let imagePath = 'view/assets/img/logo.png';
                        
                        if (rawImage) {
                            if (rawImage.startsWith('produit_')) {
                                imagePath = `view/assets/img/produits/${rawImage}`;
                            } else {
                                imagePath = `view/assets/img/${rawImage}`;
                            }
                        }
                        
                        html += `<div class="test-result">
                            <h3>Article ${index + 1}: ${item.nom}</h3>
                            <p><strong>Image brute (DB):</strong> <code>${item.image || 'NULL'}</code></p>
                            <p><strong>Chemin calcul√©:</strong> <code>${imagePath}</code></p>
                            <p><strong>Test d'affichage:</strong></p>
                            <img src="${imagePath}" alt="${item.nom}" 
                                 onerror="this.style.border='2px solid red'; this.alt='‚ùå Image non trouv√©e'">
                            <pre>${JSON.stringify(item, null, 2)}</pre>
                        </div>`;
                    });
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `<div class="test-result error">
                        <h2>‚ùå Erreur API</h2>
                        <p>${data.message}</p>
                    </div>`;
                }
            })
            .catch(err => {
                document.getElementById('results').innerHTML = `<div class="test-result error">
                    <h2>‚ùå Erreur de connexion</h2>
                    <p>${err.message}</p>
                </div>`;
            });
    </script>
</body>
</html>
