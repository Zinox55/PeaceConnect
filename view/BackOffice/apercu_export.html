<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Aper√ßu Export Excel - PeaceConnect</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #5F9E7F;
            border-bottom: 3px solid #5F9E7F;
            padding-bottom: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-box {
            background: linear-gradient(135deg, #5F9E7F 0%, #4a7d63 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-box .value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-box .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
        }
        th {
            background: #5F9E7F;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .btn-export {
            display: inline-block;
            padding: 15px 30px;
            background: #5F9E7F;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            margin: 20px 0;
        }
        .btn-export:hover {
            background: #4a7d63;
        }
        .section-title {
            background: #e8f5e9;
            padding: 15px;
            margin: 30px 0 20px 0;
            border-left: 4px solid #5F9E7F;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Aper√ßu de l'Export Excel - Commandes</h1>
        
        <div class="stats" id="stats"></div>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="../../controller/CommandeController.php?action=export" class="btn-export">
                üì• T√©l√©charger le fichier Excel complet
            </a>
        </div>
        
        <div class="section-title">üìã APER√áU DES DONN√âES (5 premi√®res commandes)</div>
        
        <div style="overflow-x: auto;">
            <table id="tableCommandes">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>N¬∞ Commande</th>
                        <th>Client</th>
                        <th>Email</th>
                        <th>T√©l√©phone</th>
                        <th>Total</th>
                        <th>Statut</th>
                        <th>M√©thode Paiement</th>
                        <th>Statut Paiement</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
        
        <div class="section-title">üìÑ COLONNES INCLUSES DANS L'EXPORT EXCEL</div>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Nom de la colonne</th>
                    <th>Description</th>
                    <th>Format</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>ID</td>
                    <td>Identifiant unique</td>
                    <td>Nombre</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>N¬∞ Commande</td>
                    <td>Num√©ro de commande</td>
                    <td>CMD-YYYYMMDD-XXXXX</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Nom Client</td>
                    <td>Nom complet du client</td>
                    <td>Texte</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Email Client</td>
                    <td>Adresse email</td>
                    <td>email@example.com</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>T√©l√©phone</td>
                    <td>Num√©ro de t√©l√©phone</td>
                    <td>Texte</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>Adresse</td>
                    <td>Adresse de livraison</td>
                    <td>Texte (sans sauts de ligne)</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>Total (DT)</td>
                    <td>Montant total</td>
                    <td>49,98 (format fran√ßais)</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>Statut</td>
                    <td>Statut de la commande</td>
                    <td>En Attente / Confirm√©e / Livr√©e / Annul√©e</td>
                </tr>
                <tr>
                    <td>9</td>
                    <td>M√©thode Paiement</td>
                    <td>Mode de paiement</td>
                    <td>Carte Bancaire / PayPal / Stripe / Virement</td>
                </tr>
                <tr>
                    <td>10</td>
                    <td>Statut Paiement</td>
                    <td>√âtat du paiement</td>
                    <td>Pay√© / En attente / √âchou√© / Rembours√©</td>
                </tr>
                <tr>
                    <td>11</td>
                    <td>Date Commande</td>
                    <td>Date de cr√©ation</td>
                    <td>06/12/2025 15:30</td>
                </tr>
                <tr>
                    <td>12</td>
                    <td>Date Livraison</td>
                    <td>Date pr√©vue/effective</td>
                    <td>10/12/2025 14:00</td>
                </tr>
                <tr>
                    <td>13</td>
                    <td>Nb Produits</td>
                    <td>Nombre de produits diff√©rents</td>
                    <td>Nombre</td>
                </tr>
                <tr>
                    <td>14</td>
                    <td>Quantit√© Totale</td>
                    <td>Quantit√© totale d'articles</td>
                    <td>Nombre</td>
                </tr>
            </tbody>
        </table>
        
        <div class="section-title">üìä SECTIONS DU FICHIER EXCEL</div>
        <table>
            <thead>
                <tr>
                    <th>Section</th>
                    <th>Contenu</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>1. EN-T√äTE</strong></td>
                    <td>Titre du rapport, date d'export, p√©riode</td>
                </tr>
                <tr>
                    <td><strong>2. STATISTIQUES</strong></td>
                    <td>Total commandes, revenu total, revenu moyen, r√©partition par statut</td>
                </tr>
                <tr>
                    <td><strong>3. DONN√âES</strong></td>
                    <td>Tableau avec toutes les commandes (14 colonnes)</td>
                </tr>
                <tr>
                    <td><strong>4. PIED DE PAGE</strong></td>
                    <td>Informations PeaceConnect, copyright, contact</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <script>
        async function loadData() {
            try {
                const response = await fetch('../../controller/CommandeController.php');
                const data = await response.json();
                
                if (data.success && data.data) {
                    const commandes = data.data;
                    
                    // Statistiques
                    let total = commandes.length;
                    let revenu = 0;
                    let stats = {
                        en_attente: 0,
                        confirmee: 0,
                        livree: 0,
                        annulee: 0
                    };
                    
                    commandes.forEach(cmd => {
                        revenu += parseFloat(cmd.total) || 0;
                        if (stats.hasOwnProperty(cmd.statut)) {
                            stats[cmd.statut]++;
                        }
                    });
                    
                    const moyenne = total > 0 ? (revenu / total) : 0;
                    
                    document.getElementById('stats').innerHTML = `
                        <div class="stat-box">
                            <div class="label">Total Commandes</div>
                            <div class="value">${total}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">Revenu Total</div>
                            <div class="value">${revenu.toFixed(2)} DT</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Commande Moyenne</div>
                            <div class="value">${moyenne.toFixed(2)} DT</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">En Attente</div>
                            <div class="value">${stats.en_attente}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">Confirm√©es</div>
                            <div class="value">${stats.confirmee}</div>
                        </div>
                        <div class="stat-box">
                            <div class="label">Livr√©es</div>
                            <div class="value">${stats.livree}</div>
                        </div>
                    `;
                    
                    // Tableau (5 premi√®res)
                    const premiers = commandes.slice(0, 5);
                    let html = '';
                    
                    const statutMap = {
                        'en_attente': 'En Attente',
                        'confirmee': 'Confirm√©e',
                        'livree': 'Livr√©e',
                        'annulee': 'Annul√©e'
                    };
                    
                    const methodeMap = {
                        'card': 'Carte',
                        'paypal': 'PayPal',
                        'stripe': 'Stripe',
                        'virement': 'Virement'
                    };
                    
                    const statutPaiementMap = {
                        'paye': 'Pay√©',
                        'en_attente': 'En attente',
                        'echoue': '√âchou√©',
                        'rembourse': 'Rembours√©'
                    };
                    
                    premiers.forEach(cmd => {
                        const statut = statutMap[cmd.statut] || cmd.statut;
                        const methode = methodeMap[cmd.methode_paiement] || cmd.methode_paiement || '-';
                        const statutPaiement = statutPaiementMap[cmd.statut_paiement] || cmd.statut_paiement || '-';
                        const date = cmd.date_commande ? new Date(cmd.date_commande).toLocaleDateString('fr-FR') : '-';
                        
                        html += `
                            <tr>
                                <td>${cmd.id}</td>
                                <td>${cmd.numero_commande}</td>
                                <td>${cmd.nom_client}</td>
                                <td>${cmd.email_client}</td>
                                <td>${cmd.telephone_client || '-'}</td>
                                <td>${parseFloat(cmd.total).toFixed(2)} DT</td>
                                <td>${statut}</td>
                                <td>${methode}</td>
                                <td>${statutPaiement}</td>
                                <td>${date}</td>
                            </tr>
                        `;
                    });
                    
                    document.getElementById('tbody').innerHTML = html;
                }
            } catch (error) {
                console.error('Erreur:', error);
            }
        }
        
        loadData();
    </script>
</body>
</html>
